<html>
<head>
<script language="javascript">

var expenditures;

function applyToAllFields(array, postfix, f) {
	f2 = function(e) {
		var elem = document.getElementById(e + postfix);
		f(elem);		
	}
	applyToAllExpenditures(array, f2);
}

function applyToAllExpenditures(array, f) {
	for (e in array) {
		f(e);
	}	
}

 function createTable(expenditures, newTable) {

 	for(e in expenditures) {
 		exp = expenditures[e];

		newRow = document.createElement("tr");
		newTable.appendChild(newRow);
		
		newDescCell = document.createElement("td");
		newRow.appendChild(newDescCell);
		newDescCell.innerText = exp.name;
		
		addCell = function(parentNode, createContent) {
			var newCell = document.createElement("td");
			parentNode.appendChild(newCell);
			
			newContent = createContent();
			newCell.appendChild(newContent);

			return newContent;
		}

		inputCreator = function() {
			var newContent = document.createElement("input");
			newContent.type = 'text';
			newContent.setAttribute("onBlur", "return validateNumber(this, event)");
			return newContent;
		}

		i1 = addCell(newRow, inputCreator);
		i1.value = exp.hasOwnProperty('defWd') ? exp.defWd : "";
		i1.id = e + '_wd';

		i2 = addCell(newRow, inputCreator);
		i2.value = exp.hasOwnProperty('defSs') ? exp.defWd : "";
		i2.id = e + '_ss';

		divCreator = function() {
			return document.createElement("div");
		}

		total = addCell(newRow, divCreator);
		total.id = e + '_totalPerExp';


/*		
		if ( exp.hasOwnProperty('comment') ) {
			var newComment = document.createElement("span");
			newComment.className = 'comment';
			newComment.innerText = array[exp].comment;
			newFieldCell.appendChild(newComment);
		}
*/

		newTable.appendChild(newRow);
	}
 }

function calculate() {
	sumWd = 0;
	applyToAllFields(expenditures, '_wd', function(elem) {
		sumWd += getFloat(elem);
	});

	sumSs = 0;
	applyToAllFields(expenditures, '_ss', function(elem) {
		sumSs += getFloat(elem);
	});

	function getFloat(elem) {
		v = elem.value;
		if (v=="") { v = 0; }
		return parseFloat(v);		
	}

/*	applyToAllFields(expenditures, '_totalPerExp', function(elem) {
		elem.value = 0;		
		elem.hidden = 'hidden';
	});*/

	applyToAllExpenditures(expenditures, function(e) {
		var wdElem = document.getElementById(e + "_wd");
		var ssElem = document.getElementById(e + "_ss");

		var totalElem = document.getElementById(e + "_totalPerExp");

		hoursAYear = toHoursAYear( getFloat(wdElem), getFloat(ssElem) );
		totalElem.innerText = hoursToHumanReadable( hoursAYear );
	});

	function hoursToHumanReadable(h) {
		d = new Date();
		d.setTime(h*60*60*1000);

		years = d.getYear() - 1970;
		months = d.getMonth();
		days = d.getDate() - 1;

		var result = '';
		
		if (days > 0) {

			if (months > 0) {

				if (years > 0) {
					result += years + ' лет ';
				}

				result += months + ' месяцев ';
			}

			result += days + ' дней';
		}

		return result;

	}
/*
	applyToAllFields(expenditures, '_wd', function(elem) {
		v = elem.value;
		if (v=="") { v = 0; }
		sumWd += parseFloat(v);
	});
*/
	function toHoursAYear(wdHoursADay, wsHoursADay) {
		return 365*(5/7*parseFloat(wdHoursADay) + 2/7*parseFloat(wsHoursADay));
	}

	total = toHoursAYear(sumWd, sumSs);
	busy = (5/7*sumWd + 2/7*sumSs)/24;
	alert(parseInt(100*(1-busy))+"% времени вы свободны");

}

function start() {
	expenditures = {
		sleep: { name: "Сон", defWd: 8, defSs: 8, normWd: 8, normSs: 8, group: "Л" },
		commute: { name: "Транспорт (на работу и обратно)", defWd: 1, group: "Р" },
		job: { name: "Работа", defWd: 8, group: "Р" }	
	}

	createTable(expenditures, document.getElementById("input"));
}

</script>
</head>
<body onload="start()">
	<table id="input">
		<tr>
			<th></th><th colspan="2">Затраты времени, ч</th>
		</tr>
		<tr>
			<th>Занятие</th><th>В рабочие дни</th><th>На выходных</th>
		</tr>
	</table>

	<button onClick="calculate()">Посчитать</button>

	<table id="results"></table>
</body>
</html>